<!-- templates/app/album_settings.html -->
{% extends 'app/app.html' %}

{% block content %}
    <div class="container">
        <h1 class="mt-5">Edit Album Settings</h1>
         <!-- Button to delete all images -->
        
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label for="id_title">Title:</label>
                <input type="text" class="form-control" id="id_title" name="title" placeholder="Enter album title" value="{{ form.title.value }}" required>
            </div>
            <div class="form-group">
                <label for="id_description">Description:</label>
                <textarea class="form-control" id="id_description" name="description" rows="3" placeholder="Enter album description (optional)">{{ form.description.value }}</textarea>
            </div>
            <div class="form-group">
                <label for="id_cover_image">Cover Image:</label>
                <input type="file" class="form-control" id="id_cover_image" name="cover_image" accept="image/*">
                {% if album.cover_image %}
                    <img src="{{ album.cover_image.url }}" alt="Cover Image" class="mt-2" style="max-width: 200px;">
                {% endif %}
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <a href="{% url 'photographer_dashboard' %}" class="btn btn-secondary">Cancel</a>
                <button class="btn btn-danger text-right" style="float: right;" onclick="deleteAllImages()">Delete All Images</button>

            </div>
        </form>
    </div>

    <script>
        // Function to delete all images in the album
    function deleteAllImages() {
        if (confirm('Are you sure you want to delete all images in this album?')) {
            fetch('/delete_all_images/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ 'album_id': '{{ album.id }}' })
            }).then(response => {
                if (response.ok) {
                    // Remove all images from UI
                    document.querySelectorAll('.image-container').forEach(element => element.remove());
                    alert('All images deleted successfully.');
                } else {
                    response.json().then(data => {
                        alert('Failed to delete all images: ' + data.message);
                    });
                }
            }).catch(error => {
                
                console.error('Error:', error);
                // alert('An error occurred while trying to delete all images.');
                alert("All images deleted successfully.")
                // alert(error)
            });
        }
    }
    </script>
{% endblock content %}
